@use 'sass:color'
@use 'sass:math'
@use '../_variables' as *
// --- CONFIGURACIÃ“N DE ESPACIOS ---
$gap-size: 10px
$form-max-width: 900px
$mobile-padding: 16px

// --- TIPOGRAFÃA Y COLORES DE SOPORTE ---
$header-color: #1f2937
$table-header-bg: #f9faff
$table-border-color: #c8ccd2
$table-action-color: #3b82f6 // Azul principal para acciones en tabla

//=====================================================
// 1. ESTRUCTURA GENERAL DEL FORMULARIO
//=====================================================
.dynamic-form-container
    display: flex
    flex-direction: column
    width: 100%
    max-width: $form-max-width
    margin: 0 auto
    padding: $mobile-padding
    border: 1px solid $border-color
    border-radius: 12px
    background-color: $white
    gap: $gap-size * 1.5
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05)

    @media (min-width: 768px)
        width: 90%
        padding: $gap-size * 2
        gap: $gap-size * 1.2

//=====================================================
// 2. INDICADORES DE PASOS (STEPPER)
//=====================================================
.form-steps-indicator
    counter-reset: step-counter
    display: flex
    justify-content: space-between
    align-items: flex-start
    margin-bottom: $gap-size * 2
    padding: $gap-size 0

    @media (max-width: 767px)
        display: none

    .step-item
        display: flex
        align-items: center
        flex-direction: column
        position: relative
        flex-grow: 1
        color: color.adjust($text-color, $lightness: 30%)
        font-size: 0.7rem
        font-weight: 500
        text-align: center

        // Estilo del SEPARADOR (LÃ­nea entre cÃ­rculos)
        &:not(:last-child)::after
            content: ''
            position: absolute
            top: 15px
            left: 50%
            transform: translateX(0)
            height: 2px
            width: calc(100% - 30px)
            background-color: $border-color
            z-index: 1

        // Estilo del NÃšMERO (CÃ­rculo)
        &::before
            content: counter(step-counter)
            counter-increment: step-counter
            display: flex
            justify-content: center
            align-items: center
            width: 28px
            height: 28px
            border-radius: 50%
            background-color: $border-color
            color: $white
            font-weight: 700
            margin-bottom: 5px
            flex-shrink: 0
            z-index: 2
            border: 2px solid $border-color
            transition: all 0.3s

        & > span
            position: relative
            z-index: 3
            white-space: normal

    /* Paso ACTIVO */
    .step-item-active
        color: $text-color

        &::before
            background-color: $primary-color
            border-color: $primary-color
            color: $white

//=====================================================
// 3. SECCIONES Y LAYOUT DE CAMPOS
//=====================================================
.dynamic-form-section
    // ðŸ”¥ AÃ‘ADIDO PARA LA LÃNEA GRIS
    border: 1px solid #ccc      // Color gris claro
    border-radius: 6px      // Borde redondeado sutil
    padding: $gap-size      // Relleno interno completo (arriba, derecha, abajo, izquierda)
    
    // Antiguo padding-bottom (ahora redundante si usamos padding completo)
    // padding-bottom: math.div($gap-size, 2) 

    .section-header
        display: flex
        align-items: center
        gap: math.div($gap-size, 2)
        margin-bottom: $gap-size
        padding-bottom: 8px
        border-bottom: 2px solid $primary-color
        position: relative

        .section-title
            color: $text-color
            font-weight: 700
            font-size: 1.25rem
            margin: 0
            
            @media (max-width: 767px)
                display: none

    .dynamic-section-fields-grid
        display: grid
        gap: $gap-size

    // LÃ³gica de Grid para columnas
    @for $i from 1 through 4
        .dynamic-section-columns-#{$i} .dynamic-section-fields-grid
            grid-template-columns: 1fr
    
    @media (min-width: 640px)
        .dynamic-section-columns-2 .dynamic-section-fields-grid 
            grid-template-columns: repeat(2, 1fr)
        
    
    @media (min-width: 768px)
        .dynamic-section-columns-4 .dynamic-section-fields-grid
            grid-template-columns: repeat(2, 1fr)
    
    @media (min-width: 1024px)
        .dynamic-section-columns-3 .dynamic-section-fields-grid
            grid-template-columns: repeat(3, 1fr)
    
    @media (min-width: 1200px)
        .dynamic-section-columns-4 .dynamic-section-fields-grid
            grid-template-columns: repeat(4, 1fr)

//=====================================================
// 4. ESTILOS DE INPUTS Y GRUPOS
//=====================================================

.dynamic-form-group
    display: flex
    flex-direction: column

    label
        font-weight: 600
        margin-bottom: 4px
        color: $text-color
        font-size: 0.9rem

.required-star
    color: $error-color
    margin-left: 4px

.dynamic-form-input
    padding: 8px 12px
    border: 1px solid color.adjust($border-color, $lightness: 10%)
    border-radius: 8px
    font-size: 1rem
    box-sizing: border-box
    width: 100%
    transition: all 0.2s ease
    background-color: $card-bg
    color: $text-color

    &:hover
        border-color: $border-color

    &:focus
        border-color: $primary-color
        outline: none
        box-shadow: 0 1px 0 0 $primary-color

textarea.dynamic-form-input
    resize: vertical
    min-height: 100px

// Estilos de checkbox y radio (consolidados)
.dynamic-form-checkbox-group, .dynamic-form-radio-group .radio-label
    display: flex
    align-items: center
    gap: 8px

    input[type="checkbox"], input[type="radio"]
        cursor: pointer
        min-width: 16px
        min-height: 16px
        flex-shrink: 0

    .checkbox-label, .radio-label
        color: $text-color
        cursor: pointer
        font-weight: 500

//=====================================================
// 5. BOTONES DE ACCIÃ“N (CONSOLIDADOS)
//=====================================================
.dynamic-form-actions-wrapper
    display: flex
    justify-content: space-between
    gap: 10px
    margin-top: $gap-size * 1.5
    padding-top: $gap-size
    border-top: 1px solid color.adjust($border-color, $lightness: 10%)

    .dynamic-form-submit-group
        display: flex
        justify-content: flex-end
        gap: 10px
        flex-grow: 1
    
    .dynamic-form-submit-btn
        padding: 12px 18px
        border-radius: 8px
        cursor: pointer
        font-size: 1rem
        font-weight: 600
        transition: all 0.2s ease
        white-space: nowrap
        line-height: 1.2
        border: none

        @media (max-width: 767px)
            width: 100%
        
        // Estilo Deshabilitado (AplÃ­ca a todos los botones)
        &:disabled
            background-color: $light-gray !important
            color: #999 !important
            cursor: not-allowed
            opacity: 0.8
            transform: none
            box-shadow: none
        
    /* Estilo Primario (Guardar/Submit/Siguiente) */
    .dynamic-form-submit-btn--primary
        background-color: $primary-color
        color: #fff

        &:hover:not(:disabled)
            background-color: color.adjust($primary-color, $lightness: -8%)
            transform: translateY(-1px)
            box-shadow: 0 2px 4px rgba($primary-color, 0.3)

    /* ðŸ›‘ Estilo Secundario (Anterior/Cancelar/Acciones) - CORREGIDO PARA SER MÃS CLARO */
    .dynamic-form-submit-btn--secondary
        background-color: $white // Fondo blanco para mayor contraste
        color: $text-color // Color de texto estÃ¡ndar
        border: 1px solid $border-color
        font-weight: 500

        &:hover:not(:disabled)
            background-color: $light-gray // Gris claro en hover
            border-color: $light-gray
            color: $text-color
            transform: none
            box-shadow: none

    // âœ… RESPONSIVE: Apilamiento vertical en mÃ³vil
    @media (max-width: 767px)
        flex-direction: column

        // Revertir el orden para que el botÃ³n primario estÃ© abajo
        .dynamic-form-submit-btn--primary
            order: 2

        .dynamic-form-submit-btn--secondary
            order: 1

//=====================================================
// 6. ESTILOS DE TABLA DINÃMICA
//=====================================================

.dynamic-form-table-group
    margin-top: $gap-size

.dynamic-table-wrapper
    width: 100%
    overflow-x: auto
    margin: 10px 0
    border: 1px solid #d1d5db
    border-radius: 8px
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03)
    background-color: #ffffff
    display: flex
    flex-direction: column

.dynamic-table
    width: 100%
    border-collapse: collapse
    font-size: 0.95rem
    min-width: 600px

    th, td
        padding: 8px 15px
        text-align: left
        border-bottom: 1px solid $table-border-color
        white-space: nowrap 

    th
        background-color: $table-header-bg
        color: $header-color
        font-weight: 600
        border-top: 2px solid $table-action-color
        text-transform: uppercase
        font-size: 0.8rem
        letter-spacing: 0.05em

    tr:nth-child(even)
        background-color: #f9faff

    tr:hover
        background-color: #f6f7f8
        transition: background-color 0.2s

    tr:last-child td
        border-bottom: none

// âœ… ESTILOS PARA INPUTS DENTRO DE CELDAS (CONSOLIDADOS)
.dynamic-table-cell-input
    // Sobrescribe el estilo general .dynamic-form-input
    padding: 6px 8px !important
    border-radius: 6px !important
    font-size: 0.9rem !important
    height: auto !important
    line-height: 1.2 !important
    box-shadow: none !important
    background-color: #ffffff !important
    color: #1f2937 !important
    border: 1px solid $table-border-color !important
    
    &:focus
        box-shadow: 0 0 0 1px $table-action-color !important
        border-color: $table-action-color !important
        outline: none

// Estilo especÃ­fico para Textarea en celda
.cell-textarea .dynamic-table-cell-input
    resize: vertical
    min-height: 30px
    font-family: inherit

// Estilo especÃ­fico para Select en celda
.cell-select .dynamic-table-cell-input
    appearance: none
    cursor: pointer
    padding-right: 24px

// Estilo para Checkbox en celda
.cell-checkbox input[type="checkbox"]
    width: 20px
    height: 20px
    cursor: pointer
    border: 1px solid $table-border-color
    border-radius: 4px
    background-color: #ffffff
    display: inline-block
    position: relative
    transition: all 0.2s ease
    
    // Check mÃ¡s visible
    &::after
        content: ""
        position: absolute
        top: 50%
        left: 50%
        width: 10px
        height: 6px
        border-left: 2px solid #ffffff
        border-bottom: 2px solid #ffffff
        transform: translate(-50%, -50%) rotate(-45deg)
        opacity: 0
        transition: opacity 0.2s ease

    &:checked
        background-color: $table-action-color
        border-color: $table-action-color

        &::after
            opacity: 1

// Botones de acciÃ³n de fila y tabla
.dynamic-table-remove-btn
    background: none
    border: none
    cursor: pointer
    font-size: 1.2rem
    padding: 0
    margin: 0
    line-height: 1
    transition: transform 0.1s ease

    &:hover
        transform: scale(1.1)

.dynamic-table-add-btn
    align-self: flex-start
    margin: 10px
    padding: 8px 12px
    border-radius: 8px
    cursor: pointer
    font-size: 0.9rem
    font-weight: 600
    transition: all 0.2s ease
    background-color: $table-action-color
    color: #ffffff
    border: 1px solid $table-action-color

    &:hover
        background-color: color.adjust($table-action-color, $lightness: -8%)
        transform: translateY(-1px)
        box-shadow: 0 2px 4px rgba($table-action-color, 0.3)


//=====================================================
// 7. ESTILOS DE PAGINACIÃ“N (NUEVO)
//=====================================================
.dynamic-table-pagination-controls
    display: flex
    justify-content: flex-end
    align-items: center
    padding: 10px
    gap: 10px
    border-top: 1px solid $table-border-color
    background-color: $table-header-bg
    border-bottom-left-radius: 8px
    border-bottom-right-radius: 8px
    font-size: 0.9rem
    color: $text-color

    button
        @extend .dynamic-form-submit-btn--secondary
        padding: 6px 10px
        font-size: 0.8rem
        border-radius: 6px
        min-width: auto
    
    select
        @extend .dynamic-form-input
        padding: 6px 10px
        width: auto
        font-size: 0.9rem
        height: auto
        margin-left: 10px


@media (min-width: 768px)
    .dynamic-table
        th, td
            white-space: normal
            padding: 12px 15px

.dynamic-table-pagination-controls
    display: flex
    justify-content: flex-end
    align-items: center
    padding: 10px
    gap: 10px
    border-top: 1px solid $table-border-color
    background-color: $table-header-bg
    border-bottom-left-radius: 8px
    border-bottom-right-radius: 8px
    font-size: 0.9rem
    color: $text-color
    
    // ðŸ›‘ CORRECCIÃ“N CLAVE AQUÃ PARA LOS BOTONES DE PAGINACIÃ“N
    button
        // Extiende el estilo secundario, pero forzamos el fondo para que no se vea oscuro
        @extend .dynamic-form-submit-btn--secondary
        
        padding: 6px 10px
        font-size: 0.8rem
        border-radius: 6px
        min-width: auto
        
        // ðŸ”¥ Sobrescribir el estilo para que sean CLAROS (fondo blanco con borde)
        background-color: $white !important // Usar fondo blanco
        color: $text-color !important     // Texto oscuro

        &:hover:not(:disabled)
            background-color: $light-gray !important
        
        // Estilo cuando estÃ¡n deshabilitados (si heredan estilos oscuros globales)
        &:disabled
            background-color: #f1f1f1 !important // Gris muy claro para deshabilitado
            color: #999 !important

    
    select
        @extend .dynamic-form-input
        padding: 6px 10px
        width: auto
        font-size: 0.9rem
        height: auto
        margin-left: 10px


@media (min-width: 768px)
    .dynamic-table
        th, td
            white-space: normal
            padding: 12px 15px

//=====================================================
// 8. ESTILOS DE SELECTOR DE ÃRBOL (DynamicTreeSelect)
//=====================================================

// ðŸ›‘ Variable local para el hover sutil
$tree-hover-bg: color.adjust($light-gray, $lightness: -2%);

//=====================================================
// 8. ESTILOS DE SELECTOR DE ÃRBOL (DynamicTreeSelect)
//=====================================================

// ðŸ›‘ Variable local para el hover sutil (usando $light-gray de tus variables)
$tree-hover-bg: color.adjust($light-gray, $lightness: -2%)

//=====================================================
// 8. ESTILOS DE SELECTOR DE ÃRBOL (DynamicTreeSelect)
//=====================================================

// ðŸ›‘ NUEVAS VARIABLES DERIVADAS
$tree-hover-bg: color.adjust($light-gray, $lightness: -2%)
$selected-bg-soft: color.adjust($primary-color, $lightness: 45%) // Fondo suave del primario (ej: lila muy claro)

//=====================================================
// 8. ESTILOS DE SELECTOR DE ÃRBOL (DynamicTreeSelect)
//=====================================================

.dynamic-tree-select-wrapper
  width: 100%
  max-height: 400px
  overflow-y: auto
  padding: $spacing-sm
  border: 1px solid $border-color
  border-radius: $border-radius-md
  background-color: $white
  box-shadow: $shadow-base
  box-sizing: border-box

.tree-node
  display: flex
  flex-direction: column
  margin-top: 2px

  .node-content
    display: flex
    align-items: center
    padding: 3px $spacing-sm 3px 0
    cursor: pointer
    user-select: none
    transition: background-color 0.15s ease
    min-height: $min-touch-target
    border-radius: 4px

    // ðŸ›‘ RESALTADO DE FILA SELECCIONADA
    .tree-node input[type="checkbox"]:checked ~ &
      background-color: $selected-bg-soft

    .tree-toggle-placeholder
      width: 25px
      height: 1px

    &:hover
      background-color: $tree-hover-bg

    label
      margin-bottom: 0
      font-weight: $font-weight-medium
      color: $text-color
      cursor: pointer
      flex-grow: 1
      line-height: $line-height-normal

// -----------------------------------------------------
// ðŸ›‘ ESTILOS DE LOS CHECKBOXES PERSONALIZADOS
// -----------------------------------------------------
.tree-node input[type="checkbox"]
  min-width: 18px
  min-height: 18px
  width: 18px
  height: 18px
  margin-right: 4px
  appearance: none
  flex-shrink: 0
  cursor: pointer
  position: relative
  
  // Base: Borde gris claro, fondo blanco
  border: 1px solid $border-color !important
  background-color: $white !important
  border-radius: 3px

  // Estado CHECKED
  &:checked
    background-color: $primary-color !important
    border-color: $primary-color !important

    &::after
      content: ''
      position: absolute
      top: 50%
      left: 50%
      opacity: 1
      transform: translate(-50%, -50%) rotate(45deg)
      border: 2px solid $white
      border-top: none
      border-left: none
      width: 5px
      height: 10px

  // Estado INDETERMINADO (parcial)
  &:indeterminate
    background-color: $primary-color !important
    border-color: $primary-color !important

    &::before
      content: ''
      position: absolute
      top: 50%
      left: 50%
      transform: translate(-50%, -50%)
      width: 10px
      height: 2px
      background-color: $white
      border: none
      border-radius: 1px

// -----------------------------------------------------
// ðŸ›‘ ESTILOS ESPECÃFICOS PARA EL BOTÃ“N DE COLAPSO (Toggle)
// -----------------------------------------------------

.tree-toggle-button
  // ðŸ›‘ DiseÃ±o Plano y Compacto
  background: none !important
  border: 1px solid transparent !important // Borde transparente para efecto hover
  padding: 0 !important // Padding nulo para que sea solo el Ã­cono
  margin-right: 5px !important
  width: 25px // Espacio fijo para el Ã­cono y el hover
  height: 25px
  border-radius: $border-radius-sm // Bordes cuadrados suaves
  cursor: pointer !important
  font-size: $font-size-sm !important // El texto/Ã­cono es mÃ¡s pequeÃ±o
  color: $text-color-light !important
  display: flex
  align-items: center
  justify-content: center
  flex-shrink: 0
  transition: all 0.2s ease

  &:hover
    background-color: $tree-hover-bg // Fondo sutil en hover
    border-color: color.adjust($border-color, $lightness: -5%) // Borde en hover
    color: $primary-color // Ãcono primario en hover

// RotaciÃ³n del Ã­cono de expansiÃ³n
.tree-node.is-expanded > .node-content > .tree-toggle-button
  transform: rotate(90deg) // Rotar 90 grados al expandirse

// -----------------------------------------------------
// ðŸ›‘ ESTILOS VISUALES POR NIVEL/TIPO (JerarquÃ­a)
// -----------------------------------------------------

.tree-level-0
  margin-left: 0 !important
  & > .node-content
    border-bottom: 1px solid color.adjust($border-color, $lightness: 5%)
    padding-bottom: 4px
    padding-top: 8px
  & > .node-content label
    font-weight: $font-weight-bold
    font-size: $font-size-md
    color: $header-color

.tree-level-1
  & > .node-content label
    font-weight: $font-weight-semibold
    font-size: $font-size-base
    color: $header-color

.tree-level-2, .tree-level-3
  & > .node-content label
    font-weight: $font-weight-normal
    font-size: $font-size-sm
    color: $text-color

// Resaltado del texto del nodo seleccionado
.tree-node input[type="checkbox"]:checked ~ .node-content label
  font-weight: $font-weight-semibold
  color: color.adjust($primary-color, $lightness: -10%)

  //=====================================================
// ðŸ›‘ NUEVO: 9. ESTILOS DE INPUT DE BÃšSQUEDA DEL ÃRBOL
//=====================================================

.tree-search-input
    // ðŸ›‘ Hereda propiedades base de tu input estÃ¡ndar
    @extend .dynamic-form-input 
    
    // AnulaciÃ³n de margen y padding para compacidad en el contenedor del Ã¡rbol
    margin-bottom: $spacing-sm !important 
    padding: 8px 12px !important
    font-size: $font-size-base !important
    height: auto !important
    
    
    // Asegura que no haya fondos oscuros ni colores oscuros en focus
    background-color: $white !important
    color: $text-color !important
    
    // Estilo de foco (se mantiene el color primario de tu sistema)
    &:focus
        border-color: $primary-color !important
        outline: none !important
        box-shadow: 0 0 0 1px $primary-color !important

// =====================================================
// ESTILOS GENÃ‰RICOS PARA EL RESUMEN DINÃMICO (DynamicSummaryDisplay)
// PropÃ³sito: Mostrar datos de solo lectura de formularios multi-paso en formato acordeÃ³n.
// =====================================================

// ðŸ›‘ VARIABLES DERIVADAS UTILIZANDO TUS VARIABLES DE BASE
$accordion-border: color.adjust($border-color, $lightness: -5%); // Un borde un poco mÃ¡s oscuro que el general
$accordion-hover-bg: color.adjust($light-gray, $lightness: -2%);
$accordion-title-color: $header-color;


.dynamic-summary-wrapper
    // Contenedor principal del resumen/acordeÃ³n
    width: 100%
    padding: 0
    box-sizing: border-box
    
    .summary-main-title
        // TÃ­tulo principal (Ej: RevisiÃ³n y ConfirmaciÃ³n Final)
        font-size: $font-size-2xl; // 22px
        font-weight: $font-weight-bold;
        color: $header-color;
        margin-bottom: $spacing-md;
        text-align: center;

    .summary-confirmation-text
        // Mensaje final antes de enviar
        font-size: $font-size-base;
        font-weight: $font-weight-medium;
        text-align: center;
        padding: $spacing-md 0;
        margin-top: $spacing-lg;
        border-top: 1px solid $accordion-border;


// -----------------------------------------------------
// ðŸ›‘ ESTILOS DE ACORDEÃ“N (Section by Section)
// -----------------------------------------------------

.summary-accordion-item
    // Estructura de cada paso/secciÃ³n colapsable
    border: 1px solid $accordion-border;
    border-radius: $border-radius-base; // 6px
    margin-bottom: $spacing-sm; // 8px
    background: $white;
    overflow: hidden;
    transition: box-shadow 0.2s ease;
    
    // Resaltado cuando estÃ¡ abierto/activo
    &.is-open
        box-shadow: 0 2px 5px rgba($primary-color, 0.1)

    .summary-accordion-header
        // Cabecera que actÃºa como botÃ³n de toggle
        padding: $spacing-sm $spacing-md;
        display: flex;
        align-items: center;
        cursor: pointer;
        transition: background-color 0.2s;
        
        &:hover
            background-color: $accordion-hover-bg;
            
        .summary-section-title
            // TÃ­tulo de la secciÃ³n (Ej: Datos Generales)
            margin: 0;
            font-size: $font-size-base;
            font-weight: $font-weight-semibold;
            color: $accordion-title-color;
            
        .accordion-toggle-icon
            // Ãcono de flecha/triÃ¡ngulo
            display: inline-block;
            width: 20px;
            font-size: $font-size-lg;
            font-weight: $font-weight-bold;
            color: $text-color-light;
            transition: transform 0.2s ease;
            margin-right: $spacing-sm;
            flex-shrink: 0;

// RotaciÃ³n del Ã­cono cuando la secciÃ³n estÃ¡ abierta
.summary-accordion-item.is-open > .summary-accordion-header .accordion-toggle-icon
    transform: rotate(90deg)


// -----------------------------------------------------
// ðŸ›‘ ESTILOS DEL CONTENIDO (Datos de solo lectura)
// -----------------------------------------------------

.summary-accordion-content
    // Contenedor que solo se muestra cuando la secciÃ³n estÃ¡ abierta
    border-top: 1px solid $accordion-border;
    padding: $spacing-md;
    
    .summary-detail-grid
        // Layout para presentar Label: Value (Dos columnas)
        display: grid;
        grid-template-columns: 1fr 1fr; 
        gap: $spacing-sm $spacing-md;
        
        @media (max-width: $breakpoint-sm)  
            grid-template-columns: 1fr;
         

        .summary-item
            // Estilo de cada par Label: Value
            margin: 0;
            font-size: $font-size-sm;
            line-height: $line-height-normal;
            
            strong
                // Etiqueta (Ej: "Criticidad:")
                font-weight: $font-weight-semibold;
                color: $text-color;
