@use 'sass:color'
@use 'sass:math'
@use '../_variables' as *
// --- CONFIGURACI√ìN DE ESPACIOS ---
$gap-size: 10px
$form-max-width: 900px
$mobile-padding: 16px

// --- TIPOGRAF√çA Y COLORES DE SOPORTE ---
$header-color: #1f2937
$table-header-bg: #f9faff
$table-border-color: #c8ccd2
$table-action-color: #3b82f6 // Azul principal para acciones en tabla

//=====================================================
// 1. ESTRUCTURA GENERAL DEL FORMULARIO
//=====================================================
.dynamic-form-container
    display: flex
    flex-direction: column
    width: 100%
    max-width: $form-max-width
    margin: 0 auto
    padding: $mobile-padding
    border: 1px solid $border-color
    border-radius: 12px
    background-color: $white
    gap: $gap-size * 1.5
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05)

    @media (min-width: 768px)
        width: 90%
        padding: $gap-size * 2
        gap: $gap-size * 1.2

//=====================================================
// 2. INDICADORES DE PASOS (STEPPER)
//=====================================================
.form-steps-indicator
    counter-reset: step-counter
    display: flex
    justify-content: space-between
    align-items: flex-start
    margin-bottom: $gap-size * 2
    padding: $gap-size 0

    @media (max-width: 767px)
        display: none

    .step-item
        display: flex
        align-items: center
        flex-direction: column
        position: relative
        flex-grow: 1
        color: color.adjust($text-color, $lightness: 30%)
        font-size: 0.7rem
        font-weight: 500
        text-align: center

        // Estilo del SEPARADOR (L√≠nea entre c√≠rculos)
        &:not(:last-child)::after
            content: ''
            position: absolute
            top: 15px
            left: 50%
            transform: translateX(0)
            height: 2px
            width: calc(100% - 30px)
            background-color: $border-color
            z-index: 1

        // Estilo del N√öMERO (C√≠rculo)
        &::before
            content: counter(step-counter)
            counter-increment: step-counter
            display: flex
            justify-content: center
            align-items: center
            width: 28px
            height: 28px
            border-radius: 50%
            background-color: $border-color
            color: $white
            font-weight: 700
            margin-bottom: 5px
            flex-shrink: 0
            z-index: 2
            border: 2px solid $border-color
            transition: all 0.3s

        & > span
            position: relative
            z-index: 3
            white-space: normal

    /* Paso ACTIVO */
    .step-item-active
        color: $text-color

        &::before
            background-color: $primary-color
            border-color: $primary-color
            color: $white

//=====================================================
// 3. SECCIONES Y LAYOUT DE CAMPOS
//=====================================================
.dynamic-form-section
    // üî• A√ëADIDO PARA LA L√çNEA GRIS
    border: 1px solid #ccc      // Color gris claro
    border-radius: 6px      // Borde redondeado sutil
    padding: $gap-size      // Relleno interno completo (arriba, derecha, abajo, izquierda)
    
    // Antiguo padding-bottom (ahora redundante si usamos padding completo)
    // padding-bottom: math.div($gap-size, 2) 

    .section-header
        display: flex
        align-items: center
        gap: math.div($gap-size, 2)
        margin-bottom: $gap-size
        padding-bottom: 8px
        border-bottom: 2px solid $primary-color
        position: relative

        .section-title
            color: $text-color
            font-weight: 700
            font-size: 1.25rem
            margin: 0
            
            @media (max-width: 767px)
                display: none

    .dynamic-section-fields-grid
        display: grid
        gap: $gap-size

    // L√≥gica de Grid para columnas
    @for $i from 1 through 4
        .dynamic-section-columns-#{$i} .dynamic-section-fields-grid
            grid-template-columns: 1fr
    
    @media (min-width: 640px)
        .dynamic-section-columns-2 .dynamic-section-fields-grid
            grid-template-columns: repeat(2, 1fr)
    
    @media (min-width: 768px)
        .dynamic-section-columns-4 .dynamic-section-fields-grid
            grid-template-columns: repeat(2, 1fr)
    
    @media (min-width: 1024px)
        .dynamic-section-columns-3 .dynamic-section-fields-grid
            grid-template-columns: repeat(3, 1fr)
    
    @media (min-width: 1200px)
        .dynamic-section-columns-4 .dynamic-section-fields-grid
            grid-template-columns: repeat(4, 1fr)

//=====================================================
// 4. ESTILOS DE INPUTS Y GRUPOS
//=====================================================

.dynamic-form-group
    display: flex
    flex-direction: column

    label
        font-weight: 600
        margin-bottom: 4px
        color: $text-color
        font-size: 0.9rem

.required-star
    color: $error-color
    margin-left: 4px

.dynamic-form-input
    padding: 8px 12px
    border: 1px solid color.adjust($border-color, $lightness: 10%)
    border-radius: 8px
    font-size: 1rem
    box-sizing: border-box
    width: 100%
    transition: all 0.2s ease
    background-color: $card-bg
    color: $text-color

    &:hover
        border-color: $border-color

    &:focus
        border-color: $primary-color
        outline: none
        box-shadow: 0 1px 0 0 $primary-color

textarea.dynamic-form-input
    resize: vertical
    min-height: 100px

// Estilos de checkbox y radio (consolidados)
.dynamic-form-checkbox-group, .dynamic-form-radio-group .radio-label
    display: flex
    align-items: center
    gap: 8px

    input[type="checkbox"], input[type="radio"]
        cursor: pointer
        min-width: 16px
        min-height: 16px
        flex-shrink: 0

    .checkbox-label, .radio-label
        color: $text-color
        cursor: pointer
        font-weight: 500

//=====================================================
// 5. BOTONES DE ACCI√ìN (CONSOLIDADOS)
//=====================================================
.dynamic-form-actions-wrapper
    display: flex
    justify-content: space-between
    gap: 10px
    margin-top: $gap-size * 1.5
    padding-top: $gap-size
    border-top: 1px solid color.adjust($border-color, $lightness: 10%)

    .dynamic-form-submit-group
        display: flex
        justify-content: flex-end
        gap: 10px
        flex-grow: 1
    
    .dynamic-form-submit-btn
        padding: 12px 18px
        border-radius: 8px
        cursor: pointer
        font-size: 1rem
        font-weight: 600
        transition: all 0.2s ease
        white-space: nowrap
        line-height: 1.2
        border: none

        @media (max-width: 767px)
            width: 100%
        
        // Estilo Deshabilitado (Apl√≠ca a todos los botones)
        &:disabled
            background-color: $light-gray !important
            color: #999 !important
            cursor: not-allowed
            opacity: 0.8
            transform: none
            box-shadow: none
        
    /* Estilo Primario (Guardar/Submit/Siguiente) */
    .dynamic-form-submit-btn--primary
        background-color: $primary-color
        color: #fff

        &:hover:not(:disabled)
            background-color: color.adjust($primary-color, $lightness: -8%)
            transform: translateY(-1px)
            box-shadow: 0 2px 4px rgba($primary-color, 0.3)

    /* üõë Estilo Secundario (Anterior/Cancelar/Acciones) - CORREGIDO PARA SER M√ÅS CLARO */
    .dynamic-form-submit-btn--secondary
        background-color: $white // Fondo blanco para mayor contraste
        color: $text-color // Color de texto est√°ndar
        border: 1px solid $border-color
        font-weight: 500

        &:hover:not(:disabled)
            background-color: $light-gray // Gris claro en hover
            border-color: $light-gray
            color: $text-color
            transform: none
            box-shadow: none

    // ‚úÖ RESPONSIVE: Apilamiento vertical en m√≥vil
    @media (max-width: 767px)
        flex-direction: column

        // Revertir el orden para que el bot√≥n primario est√© abajo
        .dynamic-form-submit-btn--primary
            order: 2

        .dynamic-form-submit-btn--secondary
            order: 1

//=====================================================
// 6. ESTILOS DE TABLA DIN√ÅMICA
//=====================================================

.dynamic-form-table-group
    margin-top: $gap-size

.dynamic-table-wrapper
    width: 100%
    overflow-x: auto
    margin: 10px 0
    border: 1px solid #d1d5db
    border-radius: 8px
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03)
    background-color: #ffffff
    display: flex
    flex-direction: column

.dynamic-table
    width: 100%
    border-collapse: collapse
    font-size: 0.95rem
    min-width: 600px

    th, td
        padding: 8px 15px
        text-align: left
        border-bottom: 1px solid $table-border-color
        white-space: nowrap 

    th
        background-color: $table-header-bg
        color: $header-color
        font-weight: 600
        border-top: 2px solid $table-action-color
        text-transform: uppercase
        font-size: 0.8rem
        letter-spacing: 0.05em

    tr:nth-child(even)
        background-color: #f9faff

    tr:hover
        background-color: #f6f7f8
        transition: background-color 0.2s

    tr:last-child td
        border-bottom: none

// ‚úÖ ESTILOS PARA INPUTS DENTRO DE CELDAS (CONSOLIDADOS)
.dynamic-table-cell-input
    // Sobrescribe el estilo general .dynamic-form-input
    padding: 6px 8px !important
    border-radius: 6px !important
    font-size: 0.9rem !important
    height: auto !important
    line-height: 1.2 !important
    box-shadow: none !important
    background-color: #ffffff !important
    color: #1f2937 !important
    border: 1px solid $table-border-color !important
    
    &:focus
        box-shadow: 0 0 0 1px $table-action-color !important
        border-color: $table-action-color !important
        outline: none

// Estilo espec√≠fico para Textarea en celda
.cell-textarea .dynamic-table-cell-input
    resize: vertical
    min-height: 30px
    font-family: inherit

// Estilo espec√≠fico para Select en celda
.cell-select .dynamic-table-cell-input
    appearance: none
    cursor: pointer
    padding-right: 24px

// Estilo para Checkbox en celda
.cell-checkbox input[type="checkbox"]
    width: 20px
    height: 20px
    cursor: pointer
    border: 1px solid $table-border-color
    border-radius: 4px
    background-color: #ffffff
    display: inline-block
    position: relative
    transition: all 0.2s ease
    
    // Check m√°s visible
    &::after
        content: ""
        position: absolute
        top: 50%
        left: 50%
        width: 10px
        height: 6px
        border-left: 2px solid #ffffff
        border-bottom: 2px solid #ffffff
        transform: translate(-50%, -50%) rotate(-45deg)
        opacity: 0
        transition: opacity 0.2s ease

    &:checked
        background-color: $table-action-color
        border-color: $table-action-color

        &::after
            opacity: 1

// Botones de acci√≥n de fila y tabla
.dynamic-table-remove-btn
    background: none
    border: none
    cursor: pointer
    font-size: 1.2rem
    padding: 0
    margin: 0
    line-height: 1
    transition: transform 0.1s ease

    &:hover
        transform: scale(1.1)

.dynamic-table-add-btn
    align-self: flex-start
    margin: 10px
    padding: 8px 12px
    border-radius: 8px
    cursor: pointer
    font-size: 0.9rem
    font-weight: 600
    transition: all 0.2s ease
    background-color: $table-action-color
    color: #ffffff
    border: 1px solid $table-action-color

    &:hover
        background-color: color.adjust($table-action-color, $lightness: -8%)
        transform: translateY(-1px)
        box-shadow: 0 2px 4px rgba($table-action-color, 0.3)


//=====================================================
// 7. ESTILOS DE PAGINACI√ìN (NUEVO)
//=====================================================
.dynamic-table-pagination-controls
    display: flex
    justify-content: flex-end
    align-items: center
    padding: 10px
    gap: 10px
    border-top: 1px solid $table-border-color
    background-color: $table-header-bg
    border-bottom-left-radius: 8px
    border-bottom-right-radius: 8px
    font-size: 0.9rem
    color: $text-color

    button
        @extend .dynamic-form-submit-btn--secondary
        padding: 6px 10px
        font-size: 0.8rem
        border-radius: 6px
        min-width: auto
    
    select
        @extend .dynamic-form-input
        padding: 6px 10px
        width: auto
        font-size: 0.9rem
        height: auto
        margin-left: 10px


@media (min-width: 768px)
    .dynamic-table
        th, td
            white-space: normal
            padding: 12px 15px

.dynamic-table-pagination-controls
    display: flex
    justify-content: flex-end
    align-items: center
    padding: 10px
    gap: 10px
    border-top: 1px solid $table-border-color
    background-color: $table-header-bg
    border-bottom-left-radius: 8px
    border-bottom-right-radius: 8px
    font-size: 0.9rem
    color: $text-color
    
    // üõë CORRECCI√ìN CLAVE AQU√ç PARA LOS BOTONES DE PAGINACI√ìN
    button
        // Extiende el estilo secundario, pero forzamos el fondo para que no se vea oscuro
        @extend .dynamic-form-submit-btn--secondary
        
        padding: 6px 10px
        font-size: 0.8rem
        border-radius: 6px
        min-width: auto
        
        // üî• Sobrescribir el estilo para que sean CLAROS (fondo blanco con borde)
        background-color: $white !important // Usar fondo blanco
        color: $text-color !important     // Texto oscuro

        &:hover:not(:disabled)
            background-color: $light-gray !important
        
        // Estilo cuando est√°n deshabilitados (si heredan estilos oscuros globales)
        &:disabled
            background-color: #f1f1f1 !important // Gris muy claro para deshabilitado
            color: #999 !important

    
    select
        @extend .dynamic-form-input
        padding: 6px 10px
        width: auto
        font-size: 0.9rem
        height: auto
        margin-left: 10px


@media (min-width: 768px)
    .dynamic-table
        th, td
            white-space: normal
            padding: 12px 15px